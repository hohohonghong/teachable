<!DOCTYPE html>
<html>
    <link rel="stylesheet" href="style.css" />
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <!-- 폰트 -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Sunflower:wght@300&display=swap"
    rel="stylesheet">
        <!-- Bootstrap CSS -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.rtl.min.css"
            integrity="sha384-DOXMLfHhQkvFFp+rWTZwVlPVqdIhpDVYT9csOnHSgWQWPX0v5MCGtjCJbY6ERspU"
            crossorigin="anonymous"
        />
        <!-- 사이트 이름 -->
        <title>스포츠 선수상 테스트</title>
        <link rel="stylesheet" href="style.css" />
        <!-- 공유 버튼 -->
        <script
            type="text/javascript"
            src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e64b3727e862b06"
        ></script>
        <!-- gtag 구글태그관리 -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-145482737-6"></script>
        <script>
            window.dataLayer = window.dataLayer || [];

            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());
            gtag('config', 'UA-145482737-6');
        </script>
    </head>
    <body>
        <!-- 웹 스타트 -->
        <section class="section">
            <h1 class="title">스포츠 선수상 테스트</h1>
            <h4 class="subtitle">나와 맞는 스포츠 분야는 무엇일까?</h4>
        </section>
        <!-- 성별 선택 -->
        <h3 class="pb-2 d-flex justify-content-center">성별을 선택하세요</h3>
        <section class="d-flex justify-content-center">
            <p class="d-flex align-items-center pr-3">여자</p>
            <div>
                <input type="checkbox" id="gender" />
                <label for="gender">
                    <span class="knob">
                        <i></i>
                    </span>
                </label>
            </div>
            <p class="d-flex align-items-center pl-3">남자</p>
        </section>
        <!-- 자바 스크립트 라이브러리 "ajax" -->
        <script
            class="jsbin"
            src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"
        ></script>
        <!-- 파일 업로드 -->
        <div class="mt-3 container file-upload">
            <div class="image-upload-wrap">
                <input
                    class="file-upload-input"
                    type="file"
                    onchange="readURL(this);"
                    accept="image/*"
                />
                <div class="drag-text">
                    <img src="img/upload.svg" class="mt-5 pt-5 upload" />
                    <h3 class="mb-5 pb-5 pt-4 upload-text">
                        얼굴 사진을 올려놓거나 눌러서 업로드하세요!
                    </h3>
                </div>
            </div>
            <!-- 업로딩 했을 때 -->
            <div class="file-upload-content">
                <img class="file-upload-image" id="face-image" src="#" alt="your image" />
                <div id="loading" class="animated bounce">
                    <div class="spinner-border" role="status">
                        <span class="sr-only"></span>
                    </div>
                    <p class="text-center">AI가 당신의 관상을 분석중입니다.</p>
                </div>
                <p class="result-message"></p>
                <div id="label-container" class="d-flex flex-column justify-content-around"></div>
                <div id="addThis" class="addthis_inline_share_toolbox_6lz1"></div>

                <div class="pt-3 image-title-wrap"></div>
            </div>
        </div>
                <!-- Modal -->

        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header"></div>
                <div class="modal-footer d-flex justify-content-center">
                    <button type="button p-2" class="try-again-btn" onclick="gaReload2();">
                        <span class="try-again-text">다른 사진으로 재시도</span>
                    </button>
                </div>
            </div>
        </div>
        <p class="text-center1">관상테스트를 끝냈다면?</p>
        <div class="modal-footer d-flex justify-content-center">
            <button type="button p-2" class="sportab" onclick="gosportsab();">
                <span class="sportab-text">운동 적성 테스트 하기</span>
            </button>
        </div>


        <script>
            function gosportsab(){
                location.href = "sprotsability/index.html";
            }
            function gaReload1() {
                gtag('event', '다른 사진으로 재시도 1차', {
                    event_category: '다른 사진으로 재시도',
                });
            }
            function gaReload2() {
                gtag('event', '다른 사진으로 재시도 2차', {
                    event_category: '다른 사진으로 재시도',
                });
                window.location.reload();
            }
        </script>
        <noscript
            >Please enable JavaScript to view the
            <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
        <!-- 자바 스크립트 라이브러리들 -->
        <script
            src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
            integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"
        ></script>
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
        <script>
            <!-- 사진을 넣었을 때 실행되는 함수 -->
            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('.image-upload-wrap').hide();
                        $('#loading').show();
                        $('.file-upload-image').attr('src', e.target.result);
                        $('.file-upload-content').show();
                        $('.image-title').html(input.files[0].name);
                    };
                    reader.readAsDataURL(input.files[0]);
                    init().then(function () {
                        console.log('hello');
                        predict();
                        $('#loading').hide();
                    });
                } else {
                    removeUpload();
                }
            }
            // 조건에 맞지 않을 때 업로딩 파일을 지움
            function removeUpload() {
                $('.file-upload-input').replaceWith($('.file-upload-input').clone());
                $('.file-upload-content').hide();
                $('.image-upload-wrap').show();
            }
            $('.image-upload-wrap').bind('dragover', function () {
                $('.image-upload-wrap').addClass('image-dropping');
            });
            $('.image-upload-wrap').bind('dragleave', function () {
                $('.image-upload-wrap').removeClass('image-dropping');
            });
        </script>
        <script type="text/javascript">
            // More API functions here:
            // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

            // the link to your model provided by Teachable Machine export panel
            // teachablemachine 링크
            let URL;
            const urlMale = 'https://teachablemachine.withgoogle.com/models/mO4jZIca3/';
            const urlFemale = 'https://teachablemachine.withgoogle.com/models/oLMGk3cjT/';

            let model, webcam, labelContainer, maxPredictions;

            // Load the image model
            async function init() {
                if (document.getElementById('gender').checked) {
                    URL = urlMale;
                } else {
                    URL = urlFemale;
                }
                const modelURL = URL + 'model.json';
                const metadataURL = URL + 'metadata.json';
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();
                labelContainer = document.getElementById('label-container');
                for (let i = 0; i < maxPredictions; i++) {
                    var element = document.createElement('div');
                    element.classList.add('d-flex');
                    labelContainer.appendChild(element);
                }
            }

            // 관상 예측
            async function predict() {
                var image = document.getElementById('face-image');
                const prediction = await model.predict(image, false);
                prediction.sort((a, b) => parseFloat(b.probability) - parseFloat(a.probability));
                console.log(prediction[0].className);
                var resultTitle, resultExplain, resultCeleb;
                // 남자ver
                if (document.getElementById('gender').checked) {
                    gtag('event', '동물상 테스트 수행', {
                        event_category: '동물상 테스트 수행',
                        event_label: '남자',
                    });
                    switch (prediction[0].className) {
                        case 'soccer':
                            resultTitle = '축구 선수상';
                            resultExplain =
                                '하루종일 야외에서 운동하며 생활하는 축구선수들은 뜨거운 햇볕 아래에서도 운동을 하기 때문에 얼굴 색은 보통 어두운색을 가지며 헤딩을 하기위해 대한민국 선수들 대부분은 머리카락 짧은편이라서 눈썹 밑으로 내려오는 선수들은 많이 없습니다. 대부분의 선수들의 인중을 보면 상당히 짙고 끝으로 갈수록 점점 선명하고 거리가 두터워지는 것을 알 수 있습니다.';
                            resultCeleb = '';
                            gtag('event', '남자 결과 강아지상', { event_category: '남자 결과' });
                            break;
                        case 'basketball':
                            resultTitle = '농구 선수상';
                            resultExplain =
                                '보통 농구선수들이 쓰는 농구장은 실내에 많이 배치되어있기 때문에 자외선의 영향을 많이 받지 않습니다. 고로 농구선수들은 다른 선수들 보다 얼굴이 대다수 하얀편이다. 농구선수상은 분위기를 고조시키는 우호적인 성격을 가지고 있는데다 책임감이 강하고 총명한 사람이라는 것을 알수 있습니다.';
                            resultCeleb =
                                '';
                            gtag('event', '남자 결과 고양이상', { event_category: '남자 결과' });
                            break;
                        case 'baseball':
                            resultTitle = '야구 선수상';
                            resultExplain =
                                ' 타격을 위한 체중 관리를 통해서 많이 먹게 되어 다른 사람에 비해 얼굴에 살이 많다. 하지만 살이 많다고 뚱뚱해 보이는 것이 아니고 더욱 남성적인 얼굴을 가졌고 카리스마가 있고 든든한 얼굴 상이다.';
                            resultCeleb =
                                '';
                            gtag('event', '남자 결과 토끼상', { event_category: '남자 결과' });
                            break;
                        case 'esports':
                            resultTitle = 'esports 선수상';
                            resultExplain =
                                '얼굴에 순진함이 묻어있네요. 하하 공부를 잘 할꺼같고 자신의 분야를 잘 할 꺼 같은 얼굴입니다.';
                            resultCeleb =
                                '';
                            gtag('event', '남자 결과 공룡상', { event_category: '남자 결과' });
                            break;
                        case 'nothing':
                            resultTitle = 'error';
                            resultExplain =
                                '사진을 각도를 바꾸거나 올바른 물체를 촬용해주세요';
                            resultCeleb =
                                '';
                            gtag('event', 'error', { event_category: '남자 결과' });
                            break;
                        default:
                            resultTitle = '알 수 없음';
                            resultExplain = '';
                            resultCeleb = '';
                            gtag('event', '남자 결과 알수없음', { event_category: '남자 결과' });
                    }
                    // 여자ver
                } else {
                    gtag('event', '동물상 테스트 수행', {
                        event_category: '동물상 테스트 수행',
                        event_label: '여자',
                    });
                    switch (prediction[0].className) {
                        case 'soccer':
                            resultTitle = '축구 선수상';
                            resultExplain =
                                '축구 선수들은 축구를 하기 위해서 짧은 머리를 많이 선호하는 편입니다. 짧은 머리가 어울리고 다른 사람들과 비교하면 근엄한 표정이 더 무서운 얼굴상. 너무 진지한 표정은 친구들에게 오해받을 수 있어요^^';
                            resultCeleb =
                                '';
                            gtag('event', '여자 결과 강아지상', { event_category: '여자 결과' });
                            break;
                        case 'basketball':
                            resultTitle = '농구 선수상';
                            resultExplain =
                                '농구 선수들은 눈매가 대체로 날카롭고 얼굴형이 마름모형 또는 육각형이다. 마름모형의 대표적인 연예인이 가인님이신데 옆턱 골격은 없는데 광대가 부각되는 형이다. 육각형은 대표적인 연예인이 한효주님으로 턱골격이 많이 있는 형을 말한다.';
                            resultCeleb =
                                '';
                            gtag('event', '여자 결과 고양이상', { event_category: '여자 결과' });
                            break;
                        case 'volley':
                            resultTitle = '배구 선수상';
                            resultExplain =
                                '갸름한 얼굴 보다는 대부분 둥근 얼굴형을 가지고 있고 보통 여우상 선수들이 많아서 매우 매력적이지만 기가 쌘 얼굴로 오해받을수 있습니다. 이 상의 성격으로는 사교성이 뛰어나 활동적인 것을 좋아하고 매사 정렬적입니다. ';
                            resultCeleb =
                                '';
                            gtag('event', '여자 결과 토끼상', { event_category: '여자 결과' });
                            break;
                        case 'skate':
                            resultTitle = '피겨 스케이트 선수상';
                            resultExplain =
                                '피겨선수들은 뛰어난 외모와 이목구비를 가지고있습니다. 날카로운 눈과 오똑한 코가 매력적이고 흰 피부와 넓은 이마가어울리는 달걀형 얼굴을 가지고있습니다. 보통은 날카로운 눈매 때문에 사람들에게 부드러운 이미지보단 강렬한 인상을줄수도 있습니다.';
                            resultCeleb =
                                '';
                            gtag('event', '여자 결과 사슴상', { event_category: '여자 결과' });
                            break;
                        case 'archery':
                            resultTitle = '양궁 선수상';
                            resultExplain =
                                '주름 한점 없고 깨끗한 얼굴을 가지고 있는 양궁선수들은 날카롭고 신중한 눈을 가지고 있어 무엇 하나에 집중하면 성실하게 끝까지 해내고 온화하며 신중하고 침착한 성격을 가지고 있습니다. 심지어 화를 잘 참고 인정이 많으며 눈물 또한 많습니다.';
                            resultCeleb =
                                '';
                            gtag('event', '여자 결과 여우상', { event_category: '여자 결과' });
                            break;
                        case 'nothing':
                            resultTitle = 'error';
                            resultExplain =
                                '사진을 각도를 바꾸거나 올바른 물체를 촬용해주세요';
                            resultCeleb =
                                '';
                            gtag('event', 'error', { event_category: '여자 결과' });
                            break;
                        default:
                            resultTitle = '알수없음';
                            resultExplain = '';
                            resultCeleb = '';
                            gtag('event', '여자 결과 알수없음', { event_category: '여자 결과' });
                    }
                }
                // 관상 name
                var title =
                    "<div class='" +
                    prediction[0].className +
                    "-animal-title'>" +
                    resultTitle +
                    '</div>';
                // 관상 설명
                var explain = "<div class='animal-explain pt-2'>" + resultExplain + '</div>';
                // 닮은 유명인물
                var celeb =
                    "<div class='" +
                    prediction[0].className +
                    "-animal-celeb pt-2 pb-2'>" +
                    resultCeleb +
                    '</div>';
                $('.result-message').html(title + explain + celeb);
                // 결과값을 도출했을 때 바 형태의 그래프 두께
                var barWidth;
                for (let i = 0; i < maxPredictions; i++) {
                    <!-- 결과값이 10퍼센트 이상일 경우 그래프 두께 -->
                    if (prediction[i].probability.toFixed(2) > 0.1) {
                        barWidth = Math.round(prediction[i].probability.toFixed(2) * 100) + '%';
                    <!-- 결과값이 1퍼센트 이상일 경우 그래프 두께 -->
                    } else if (prediction[i].probability.toFixed(2) >= 0.01) {
                        barWidth = '4%';
                    <!-- 결과값이 1퍼센트 미만일 경우 그래프 두께 -->
                    } else {
                        barWidth = '2%';
                    }
                    //그 바에 쓰여지는 글씨
                    var labelTitle;
                    switch (prediction[i].className) {
                        case 'soccer':
                            labelTitle = '축구 선수상';
                            break;
                        case 'basketball':
                            labelTitle = '농구 선수상';
                            break;
                        case 'baseball':
                            labelTitle = '야구 선수상';
                            break;
                        case 'esports':
                            labelTitle = '프로게이머상';
                            break;
                        case 'volley':
                            labelTitle = '배구 선수상';
                            break;
                        case 'skate':
                            labelTitle = '스케이트 선수상';
                            break;
                        case 'archery':
                            labelTitle = '양궁 선수상';
                            break;
                        case 'error':
                            labelTitle = '측정 불가'
                        default:
                            labelTitle = '알 수 없음';
                    }
                    //classname + 결과 값해서 나오는 도출값의 label
                    var label =
                        "<div class='animal-label d-flex align-items-center'>" +
                        labelTitle +
                        '</div>';
                    //classname + 결과 값해서 나오는 도출값의 bar
                    var bar =
                        "<div class='bar-container position-relative container'><div class='" +
                        prediction[i].className +
                        "-box'></div><div class='d-flex justify-content-center align-items-center " +
                        prediction[i].className +
                        "-bar' style='width: " +
                        barWidth +
                        "'><span class='d-block percent-text'>" +
                        Math.round(prediction[i].probability.toFixed(2) * 100) +
                        '%</span></div></div>';
                    labelContainer.childNodes[i].innerHTML = label + bar;
                }
            }
        </script>
    </body>
</html>